<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #d97706;
        }
        .log {
            background: #1e293b;
            color: #10b981;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤</h1>
    <p>–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Ç–µ—Å—Ç—É—î –±–∞–∑–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</p>
    
    <div>
        <button onclick="testSimpleDownload()">1. –ü—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª</button>
        <button onclick="testJSONDownload()">2. JSON —Ñ–∞–π–ª</button>
        <button onclick="testBlobDownload()">3. Blob —Ñ–∞–π–ª</button>
        <button onclick="testBackendZip()">4. Backend ZIP (–±–µ–∫–∞–ø)</button>
    </div>
    
    <div class="log" id="log"></div>

    <script>
        function log(message, isError = false) {
            const logDiv = document.getElementById('log');
            const span = document.createElement('div');
            span.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            if (isError) span.className = 'error';
            logDiv.appendChild(span);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function testSimpleDownload() {
            log('üîç –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª');
            try {
                const text = '–¶–µ —Ç–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª!\n–£–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.\n–ß–∞—Å: ' + new Date().toISOString();
                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'test-text.txt';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                log('‚úÖ –¢–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message, true);
            }
        }

        function testJSONDownload() {
            log('üîç –¢–µ—Å—Ç 2: JSON —Ñ–∞–π–ª');
            try {
                const data = {
                    test: '–¶–µ —Ç–µ—Å—Ç',
                    timestamp: new Date().toISOString(),
                    ukrainian: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞',
                    numbers: [1, 2, 3, 4, 5]
                };
                const jsonStr = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'test-data.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                log('‚úÖ JSON —Ñ–∞–π–ª —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message, true);
            }
        }

        function testBlobDownload() {
            log('üîç –¢–µ—Å—Ç 3: –í–µ–ª–∏–∫–∏–π Blob —Ñ–∞–π–ª');
            try {
                const largeText = '–í–µ–ª–∏–∫–∏–π —Ç–µ–∫—Å—Ç\n'.repeat(1000);
                const blob = new Blob([largeText], { type: 'text/plain' });
                log('üìä –†–æ–∑–º—ñ—Ä blob: ' + blob.size + ' –±–∞–π—Ç—ñ–≤');
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'test-large.txt';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                log('‚úÖ –í–µ–ª–∏–∫–∏–π —Ñ–∞–π–ª —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message, true);
            }
        }

        async function testBackendZip() {
            log('üîç –¢–µ—Å—Ç 4: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ZIP –∑ backend');
            try {
                const backendUrl = window.location.origin.replace(':3000', ':8001');
                const url = backendUrl + '/api/backup/download-all';
                log('üì• –ó–∞–ø–∏—Ç –¥–æ: ' + url);
                
                const response = await fetch(url);
                log('üìä –°—Ç–∞—Ç—É—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: ' + response.status);
                
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                
                const blob = await response.blob();
                log('üìä –†–æ–∑–º—ñ—Ä ZIP: ' + blob.size + ' –±–∞–π—Ç—ñ–≤');
                
                const downloadUrl = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.download = 'backend-test.zip';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(downloadUrl);
                log('‚úÖ ZIP –∑ backend –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ');
            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message, true);
                console.error(error);
            }
        }

        log('‚úÖ –¢–µ—Å—Ç–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≥–æ—Ç–æ–≤–∞');
        log('üí° –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è');
    </script>
</body>
</html>
