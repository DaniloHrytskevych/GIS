# 🔄 БЛОК-СХЕМА РОБОТИ СИСТЕМИ

## Візуальне представлення алгоритму

```
┌─────────────────────────────────────────────────────────────────┐
│                      ПОЧАТОК АНАЛІЗУ                             │
│                  (користувач відкриває карту)                    │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│              📥 ЗАВАНТАЖЕННЯ ДАНИХ                               │
│                                                                  │
│  ✓ Населення (24 регіони)                                       │
│  ✓ Інфраструктура (24 регіони)                                  │
│  ✓ ПЗФ (24 регіони)                                             │
│  ✓ Рекреаційні пункти (780 точок GeoJSON)                      │
│  ✓ Лісові пожежі (1875 інцидентів GeoJSON)                     │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│            🔁 ЦИКЛ: ДЛЯ КОЖНОГО РЕГІОНУ                         │
│                    (24 ітерації)                                 │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
               ┌─────────────────────────────┐
               │  ЕТАП 1: АНАЛІЗ РЕГІОНУ     │
               │  ═══════════════════════     │
               │                              │
               │  Розрахунок 6 показників:    │
               │  1. demand_score (0-25)      │
               │  2. pfz_score (0-20)         │
               │  3. nature_score (0-15)      │
               │  4. accessibility (0-15)     │
               │  5. infrastructure (0-10)    │
               │  6. fire_score (0-5)         │
               │                              │
               │  TOTAL_SCORE = сума (0-90)   │
               └──────────────┬───────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ TOTAL_SCORE ≥ 55?│
                    └────┬────────┬────┘
                         │ ТАК    │ НІ
                         │        │
                    ┌────▼────┐   │
                    │ ПРОДОВЖ │   │
                    │  УЖИМО  │   │
                    └────┬────┘   │
                         │        │
                         ▼        ▼
         ┌───────────────────────────────────┐
         │  ЕТАП 2: ГЕНЕРАЦІЯ ЗОН            │      ┌─────────────┐
         │  ════════════════════              │      │  ПРОПУСТИТИ │
         │                                    │      │   РЕГІОН    │
         │  🌲 Тип A: БІЛЯ ПЗФ               │      └─────────────┘
         │  ─────────────────────             │
         │  • Знайти ТОП-2 ПЗФ об'єкти       │
         │  • Генерувати координати          │
         │    (2-10 км від ПЗФ)              │
         │  • Перевірити конкуренцію         │
         │  • Розрахувати пріоритет          │
         │  • Додати якщо пріоритет ≥ 60     │
         │                                    │
         │  🚗 Тип B: ТРАСА                  │
         │  ─────────────────                 │
         │  • Знайти ТОП-2 траси (М-траси)   │
         │  • Генерувати координати          │
         │    (15-30 км від центру)          │
         │  • Перевірити конкуренцію         │
         │  • Розрахувати пріоритет          │
         │  • Додати якщо пріоритет ≥ 55     │
         │                                    │
         │  🔥 Тип C: ПОЖЕЖА                 │
         │  ─────────────────                 │
         │  • Знайти кластери (≥3 пожежі)    │
         │  • Розрахувати центр кластера     │
         │  • Перевірити конкуренцію         │
         │  • Розрахувати пріоритет          │
         │  • Додати якщо пріоритет ≥ 55     │
         └───────────────┬───────────────────┘
                         │
                         ▼
         ┌───────────────────────────────────┐
         │  ЕТАП 3: РОЗРАХУНОК ПРІОРИТЕТУ    │
         │  ════════════════════════════      │
         │                                    │
         │  function calculate_priority():    │
         │                                    │
         │  priority = 50 (база)              │
         │            + demand (0-25)         │
         │            + attractor (0-20)      │
         │            + nature (0-15)         │
         │            + transport (0-15)      │
         │            + infrastructure (0-10) │
         │            + fire (0-5)            │
         │            - saturation (0 to -15) │
         │                                    │
         │  return min(100, max(0, priority)) │
         └───────────────┬───────────────────┘
                         │
                         ▼
                ┌────────────────┐
                │ НАСТУПНИЙ      │
                │ РЕГІОН?        │
                └───┬────────┬───┘
                    │ ТАК    │ НІ
                    │        │
            ┌───────┘        └───────┐
            │                        │
            ▼                        ▼
┌─────────────────────┐    ┌─────────────────────┐
│   ПОВЕРНУТИСЬ       │    │  ЕТАП 4: ФІНАЛЬНА   │
│   ДО ЦИКЛУ          │    │  ОБРОБКА            │
│   (наступний регіон)│    │  ═══════════════     │
└─────────────────────┘    │                      │
                           │  • Сортування зон    │
                           │    за пріоритетом    │
                           │    (100 → 0)         │
                           │                      │
                           │  • Формування JSON   │
                           │    відповіді         │
                           └──────────┬───────────┘
                                      │
                                      ▼
                        ┌─────────────────────────┐
                        │   📤 ВІДПОВІДЬ API      │
                        │   ═══════════════       │
                        │                         │
                        │   {                     │
                        │     "zones": [          │
                        │       {                 │
                        │         "id": "...",    │
                        │         "type": "...",  │
                        │         "priority": 98, │
                        │         "coordinates":  │
                        │           [lat, lng],   │
                        │         ...             │
                        │       }                 │
                        │     ]                   │
                        │   }                     │
                        └────────────┬────────────┘
                                     │
                                     ▼
                        ┌─────────────────────────┐
                        │  🗺️ ВІДОБРАЖЕННЯ        │
                        │     НА КАРТІ            │
                        │  ═══════════════         │
                        │                         │
                        │  • Зони як кола з       │
                        │    пунктирною обводкою  │
                        │  • Колір за пріоритетом:│
                        │    Червоний (90-100)    │
                        │    Помаранчевий (70-89) │
                        │    Жовтий (< 70)        │
                        │  • Popup з деталями     │
                        └─────────────────────────┘
```

---

## 🔍 ДЕТАЛЬНИЙ ПІДАЛГОРИТМ: Розрахунок пріоритету для зони

```
function calculate_comprehensive_priority(
    zone_type,           // "near_pfz" | "roadside" | "fire_prevention"
    region_analysis,     // Об'єкт з 6 показниками регіону
    fire_cluster_size,   // Кількість пожеж у кластері
    competitors,         // Кількість конкурентів у радіусі 5 км
    distance_from_pfz,   // Відстань до ПЗФ (км)
    pfz_name            // Назва ПЗФ
):

    ┌─────────────────────────────────────┐
    │  КРОК 1: База                       │
    │  priority = 50                      │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 2: ПОПИТ (0-25)               │
    │  priority += region_analysis.       │
    │              demand_score           │
    │  (мін 0, макс 25)                   │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 3: АТРАКТОР (0-20)            │
    │                                      │
    │  if zone_type == "near_pfz":        │
    │    if "НПП" in pfz_name:            │
    │      attractor = 20                 │
    │    elif "заповідник" in pfz_name:   │
    │      attractor = 15                 │
    │    elif "РЛП" in pfz_name:          │
    │      attractor = 10                 │
    │    else:                            │
    │      attractor = 8                  │
    │                                      │
    │    if distance_from_pfz > 10:       │
    │      attractor *= 0.5  # Штраф      │
    │                                      │
    │  elif zone_type == "roadside":      │
    │    attractor = 15  # Міжнародна     │
    │                                      │
    │  elif zone_type == "fire_prevention"│
    │    if fire_cluster_size >= 10:      │
    │      attractor = 20                 │
    │    elif fire_cluster_size >= 7:     │
    │      attractor = 15                 │
    │    elif fire_cluster_size >= 5:     │
    │      attractor = 12                 │
    │    else:                            │
    │      attractor = 10                 │
    │                                      │
    │  priority += attractor              │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 4: ПРИРОДА (0-15)             │
    │  priority += region_analysis.       │
    │              nature_score           │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 5: ТРАНСПОРТ (0-15)           │
    │  priority += region_analysis.       │
    │              accessibility_score    │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 6: ІНФРАСТРУКТУРА (0-10)      │
    │  priority += region_analysis.       │
    │              infrastructure_score   │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 7: ПОЖЕЖІ (0-5)               │
    │  fire_component = region_analysis.  │
    │                   fire_score        │
    │                                      │
    │  if zone_type == "fire_prevention": │
    │    fire_component += 2  # Бонус     │
    │                                      │
    │  priority += min(5, fire_component) │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 8: НАСИЧЕНІСТЬ (0 до -15)     │
    │                                      │
    │  if competitors == 0:               │
    │    penalty = 0                      │
    │  elif competitors <= 2:             │
    │    penalty = -3                     │
    │  elif competitors <= 5:             │
    │    penalty = -7                     │
    │  elif competitors <= 10:            │
    │    penalty = -12                    │
    │  else:                              │
    │    penalty = -15                    │
    │                                      │
    │  priority += penalty                │
    └──────────────┬──────────────────────┘
                   │
                   ▼
    ┌─────────────────────────────────────┐
    │  КРОК 9: ОБМЕЖЕННЯ                  │
    │  priority = min(100, max(0,         │
    │                 priority))          │
    │                                      │
    │  return priority                    │
    └─────────────────────────────────────┘
```

---

## 📊 ПРИКЛАД ВИКОНАННЯ ДЛЯ ЖИТОМИРСЬКОЇ ОБЛАСТІ

```
═══════════════════════════════════════════════════════════════
РЕГІОН: Житомирська область
═══════════════════════════════════════════════════════════════

ЕТАП 1: Аналіз регіону
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
├─ Населення: 1,200,000
├─ Лісистість: 41%
├─ Водойми: Так
├─ Дороги: 380 км/1000км²
├─ Людські пожежі: 649
│
├─ ПОКАЗНИКИ:
│  ├─ demand_score: 23
│  ├─ pfz_score: 18
│  ├─ nature_score: 15
│  ├─ accessibility_score: 10
│  ├─ infrastructure_score: 5
│  └─ fire_score: 3
│
└─ TOTAL_SCORE: 74 ✅ (≥ 55 → продовжуємо)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ЕТАП 2: Генерація зон
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────────────────────────────────────────────────────────┐
│ 🌲 ТИП A: БІЛЯ ПЗФ                                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ ПЗФ: Поліський НПП                                          │
│ Seed: "Житомирська область_Поліський НПП_near"              │
│                                                              │
│ 1. Генерація координат:                                     │
│    hash = MD5(seed) = 0xa3f2...                             │
│    angle = hash % 360 = 178°                                │
│    distance = 3 + (hash // 360) % 5 = 5 км                  │
│    coordinates = [50.25 + offset_lat, 28.66 + offset_lng]  │
│                = [50.29, 28.61]                             │
│                                                              │
│ 2. Перевірка конкуренції:                                   │
│    Радіус 5 км від [50.29, 28.61]                           │
│    Знайдено: 1 рекреаційний пункт                           │
│                                                              │
│ 3. Розрахунок пріоритету:                                   │
│    base = 50                                                │
│    + demand (23)                                            │
│    + pfz_attractor (20, бо НПП)                             │
│    + nature (15)                                            │
│    + transport (10)                                         │
│    + infrastructure (5)                                     │
│    + fire (3)                                               │
│    - saturation (-3, бо 1 конкурент)                        │
│    = 123 → min(100, 123) = 100 ⭐                           │
│                                                              │
│ ✅ ДОДАНО: Біля: Поліський НПП (пріоритет 100)             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 🚗 ТИП B: ТРАСА                                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ Траса: М-06 (Київ-Чоп)                                      │
│ Seed: "Житомирська область_М-06_road"                       │
│                                                              │
│ 1. Генерація координат:                                     │
│    distance = 15-30 км від центру                           │
│    coordinates = [50.40, 28.80]                             │
│                                                              │
│ 2. Конкуренція: 2 пункти                                    │
│                                                              │
│ 3. Пріоритет:                                               │
│    base = 50                                                │
│    + demand (23)                                            │
│    + road_traffic (15)                                      │
│    + nature (15)                                            │
│    + transport (10)                                         │
│    + infrastructure (5)                                     │
│    + fire (3)                                               │
│    - saturation (-3)                                        │
│    = 118 → 100 ⭐                                           │
│                                                              │
│ ✅ ДОДАНО: Траса М-06 (пріоритет 100)                       │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 🔥 ТИП C: ПОЖЕЖНА ПРОФІЛАКТИКА                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ Пошук кластерів людських пожеж:                             │
│   ├─ Фільтр: причина == "людський фактор"                   │
│   ├─ Знайдено: 649 пожеж                                    │
│   └─ Кластери (≥3 пожежі в радіусі 10 км):                  │
│                                                              │
│ Кластер #1:                                                 │
│   ├─ Центр: [50.56, 28.85]                                  │
│   ├─ Кількість пожеж: 7                                     │
│   ├─ Конкуренція: 0                                         │
│   └─ Пріоритет:                                             │
│       base = 50                                             │
│       + demand (23)                                         │
│       + fire_cluster (15, бо 7 пожеж)                       │
│       + nature (15)                                         │
│       + transport (10)                                      │
│       + infrastructure (5)                                  │
│       + fire (5, бо +2 бонус)                               │
│       - saturation (0, немає конкурентів!)                  │
│       = 123 → 100 ⭐                                         │
│                                                              │
│ ✅ ДОДАНО: Кластер пожеж #1 (пріоритет 100)                │
└─────────────────────────────────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ЕТАП 3: Результат для Житомирської області
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ Згенеровано 4 зони:
   1. Біля: Поліський НПП (пріоритет 100)
   2. Траса М-06 (пріоритет 100)
   3. Кластер пожеж #1 (пріоритет 100)
   4. Біля: Древлянський НПП (пріоритет 95)

═══════════════════════════════════════════════════════════════
```

---

## 🎓 ВИСНОВОК

Система працює у **3 основні етапи**:

1. **Аналіз** → Розрахунок 6 показників для кожного регіону
2. **Генерація** → Створення 3 типів зон (біля ПЗФ, траси, пожежі)
3. **Пріоритизація** → 7-факторна формула для кожної зони

**Результат:** Список найкращих локацій для інвестицій у рекреаційні об'єкти, відсортований за пріоритетом.
